{% extends 'base.html' %}

{% block header %}
<h1>{% block title %}Home{% endblock %}</h1>
{% endblock %}

{% block content %}
{% if g.user %}

	<p>
	Ciao, {{ g.user['username'] }}. Hai dato la disponibilità a giocare: ricorda che
	puoi sempre <a href="{{ url_for('auth.logout') }}">ritirarla</a>.
	</p>

	<p>
	{% if players|length == 0 %}
		In questo momento non ci sono utenti disponibili a giocare (su {{ users|length }} utenti totali).
	{% elif players|length == 1 %}
		In questo momento non ci sono altri utenti disponibili a giocare (su {{ users|length }} utenti totali).
	{% else %}
		In questo momento ci sono {{ players|length }} utenti disponibili a giocare (su {{ users|length }} utenti totali):
		{% for player in players[:-1] %}{{ player['username'] }}, {% endfor %}{{ players[-1]['username'] }}.
	{% endif %}
	</p>

	<p>
	{% if players|length == 4 %}

		Partita iniziata con ordine di gioco:
		{% for player in ordered_players[:-1] %}{{ player['username'] }}, {% endfor %}
		{{ ordered_players[-1]['username'] }}.

			<p>
			{% for i in range(phase_ante) %}
				{{ ordered_players[i]['username'] }} ha messo il cip: {{ ordered_players[i]['state']['ante'] }}.
			{% endfor %}
			</p>

			<p>
			{% if phase_ante < 4 %}
				{% if ordered_players[phase_ante]['id'] == g.user['id'] %}
					<form method="post">
						Metti il cip (valori possibili: 10, 20, ..., 100):
						<input type="number" name="ante" id="ante" value="10" min="10" max="100" step="10" required>
						<input type="submit" value="Metti">
					</form>
				{% else %}
					{{ ordered_players[phase_ante]['username'] }} deve mettere il cip.
				{% endif %}
			{% endif %}
			</p>

			<p>
			{% if phase_ante == 4 %}
				{% for player in ordered_players %}
					{% if player['id'] == g.user['id'] %}
						Le tue carte iniziali sono:
						{{ show_cards(player['state']['cards_before_change']) }}.
					{% endif %}
				{% endfor %}
			{% endif %}
			</p>

	{% else %}
		Ci vogliono quattro giocatori per iniziare la partita.
	{% endif %}
	</p>

{% else %}

	{% if players|length >= 4 %}
		<p>
		Ciao, purtroppo in questo momento il tavolo è al completo
		(stanno giocando {% for player in players[:-1] %}{{ player['username'] }}, {% endfor %}{{ players[-1]['username'] }}).
		</p>
		<p>Devi aspettare che si liberi un posto per giocare.</p>
		<p>
		Nell'attesa, se non l'hai già fatto, puoi iniziare a
		<a href="{{ url_for('auth.register') }}">registrarti</a>
		(la registrazione è necessaria per giocare).
		</p>
	{% else %}
		<p>
		Ciao, non ti conosco. Vuoi <a href="{{ url_for('auth.login') }}">giocare</a>?
		(Se non l'hai già fatto, devi prima <a href="{{ url_for('auth.register') }}">registrarti</a>.)
		</p>
	{% endif %}

{% endif %}  <!-- if g.user  -->
{% endblock %}  <!-- block content -->

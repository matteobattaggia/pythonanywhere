{% extends 'base.html' %}

{% block header %}
<h1>{% block title %}Home{% endblock %}</h1>
{% endblock %}

{% block content %}
{% if g.user %}
	<p>
	Ciao, {{ g.user['username'] }}. Hai dato la disponibilità a giocare: ricorda che
	puoi sempre <a href="{{ url_for('auth.logout') }}">ritirarla</a>.
	</p>
	<p>
	{% if players|length == 0 %}
		In questo momento non ci sono utenti disponibili a giocare (su {{ users|length }} utenti totali).
	{% elif players|length == 1 %}
		In questo momento non ci sono altri utenti disponibili a giocare (su {{ users|length }} utenti totali).
	{% else %}
		In questo momento ci sono {{ players|length }} utenti disponibili a giocare (su {{ users|length }} utenti totali):
		{% for player in players[:-1] %}{{ player['username'] }}, {% endfor %}{{ players[-1]['username'] }}.
	{% endif %}
	</p>
	<p>
	{% if players|length == 4 %}
		Partita iniziata con ordine di gioco:
		{% for player in ordered_players[:-1] %}{{ player['username'] }}, {% endfor %}{{ ordered_players[-1]['username'] }}.

			<p><i>
				DEBUG:
				phase = {{ phase }};
				focused_player = {{ focused_player['username'] }};
				focused_player.playing_order = {{ focused_player['state']['playing_order'] }};
			</i></p>

			{% if phase == 'ante' %}
				{% if g.user['id'] == focused_player['id'] %}
					{% if focused_player['state']['playing_order'] == 0 %}
						<p>Devi mettere il cip per primo.</p>
					{% else %}
						<p>Devi mettere il cip.</p>
					{% endif %}
				{% else %}
					<p>{{ focused_player['username'] }} deve mettere il cip.</p>
				{% endif %}
			{% elif phase == 'action_before_change' %}
			{% elif phase == 'action_after_change' %}
			{% else %}
			{% endif %}
	{% else %}
		Ci vogliono quattro giocatori per iniziare la partita.
	{% endif %}
	</p>
{% else %}
	<p>
	{% if players|length >= 4 %}
		Ciao, purtroppo in questo momento il tavolo è al completo,
		e devi aspettare che si liberi un posto per giocare.
		(Se non l'hai già fatto, puoi iniziare a <a href="{{ url_for('auth.register') }}">registrarti</a>.)
	{% else %}
		Ciao, non ti conosco. Vuoi <a href="{{ url_for('auth.login') }}">giocare</a>?
		(Se non l'hai già fatto, devi prima <a href="{{ url_for('auth.register') }}">registrarti</a>.)
	{% endif %}
</p>
{% endif %}
{% endblock %}
